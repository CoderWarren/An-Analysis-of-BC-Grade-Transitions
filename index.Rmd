---
title: "An Analysis of BC Grade-to-Grade Transitions"
author: "Warren Zhu"
output: 
    html_document:
        toc: TRUE
        toc_float: TRUE
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
# Set up everything here. This is hidden from the final output
#install.packages(c("data.table","leaflet"))
library(data.table)
library(leaflet)
library(tidyverse)
library(ggplot2)
library(mgcv)

library(plotly)
library(knitr)
library(widgetframe)
```

$$\\[0.2in]$$

## Introduction

This site was created with the intention of investigating the education system in British Columbia, Canada. Although test scores can be quite informative, I believe they can be misleading--the difficulty of tests can fluctuate dramatically, effectively resulting in student grades also fluctuating. As such, our metric of choice was grade-to-grade transition rates. These rates do not reflect the quality of the education too accurately, but they are a very good indicator of how much support the British Columbian government is providing to its youth. As such, our questions are as follows:

**How has the British Columbian Government's educational support (as indicated by grade-to-grade transition rates) in the past 30 years differed in different kinds of schools, as well as for different types of British Columbian students (i.e., Indigenous? Special needs?)? Are there any other specific attributes that lead to a lower/higher quality of educational support?**

Note that this is quite a complex question, and so naturally, a lot of data is required to answer it. Thus, this website uses [various open data from British Columbia](https://catalogue.data.gov.bc.ca/). Our main dataset of interest is [the 1992-2021 data on grade-to-grade transition rates published by British Columbia Education Analytics](https://catalogue.data.gov.bc.ca/dataset/bc-schools-grade-to-grade-transition). This dataset consists of information on a provincial, district, and school level. Additional information gathered from supplementary datasets. [A dataset on class Sizes from 2006 to 2021](https://catalogue.data.gov.bc.ca/dataset/bc-schools-class-size) provides us information on all three levels, but here we mainly use it on the school level. For the district level, we used [a dataset regarding each district's office](https://catalogue.data.gov.bc.ca/dataset/bc-schools-school-district-information) and [a dataset regarding British Columbian Teachers for each district](https://catalogue.data.gov.bc.ca/dataset/bc-schools-teacher-statistics).

If you wish to see the Github repository for this site, [you can find it here](https://github.com/CoderWarren/An-Analysis-of-BC-Grade-Transitions).

```{r}
#TODO: Add PDF download link
```


$$\\[0.2in]$$

## Methods

### Data Prep

```{r read-in, echo=FALSE, message=FALSE, warning=FALSE}
# From: https://catalogue.data.gov.bc.ca/dataset/bc-schools-grade-to-grade-transition
#
# Read in the 1992 to 2001 data
data_1 <- data.table::fread("data_transitions/grtogrtransition_1992-93_to_2000-01.csv")
# Read in the 2001 to 2011 data
data_2 <- data.table::fread("data_transitions/grtogrtransition_2001-02_to_2010-11.csv")
# Read in the 2011 to 2021 data
data_3 <- data.table::fread("data_transitions/grtogrtransition_2011-12_to_2020-21.csv")

# From: https://catalogue.data.gov.bc.ca/dataset/bc-schools-school-district-information
#
# Read in the locations
locations <- data.table::fread("data_districts/current_district_office_information.csv")


# From: https://catalogue.data.gov.bc.ca/dataset/bc-schools-teacher-statistics
#
# Read in teacher "legacy" data
teacher_1 <- data.table::fread("data_districts/legacy-teacher-statistics-19911992-20162017.csv")
# Read in teacher data
teacher_2 <- data.table::fread("data_districts/bc-education-workforce-public-schools-to-2013-2021.csv")

# From: https://catalogue.data.gov.bc.ca/dataset/bc-schools-class-size
#
# Read in the class size data
class_sizes <- data.table::fread("data_schools/class_size_2006-07_to_2021-22.csv")
```



```{r data-prep-1, echo=FALSE, message=FALSE, warning=FALSE, results=FALSE}
# Here, we prepare the merged data set

# Combine all the data
data <- rbind(data_1, data_2, data_3)

# Remove all missing values
data <- data[!(data$DENOMINATOR_STUDIED_COHORT=="Msk"|
                 data$NUMERATOR_NUM_SUCCESSFUL=="Msk"|
               data$G2G_TRANSITION_RATE=="Msk"),]

# Make an integer variable storing the year
data$year <- strtoi(substr(data$SCHOOL_YEAR, 1, 4))

# Make the grade to grade transition rates a float
data$rate <- as.double(data$G2G_TRANSITION_RATE)

# Make the number of students an integer
data$num_students <- as.integer(data$DENOMINATOR_STUDIED_COHORT)

# Make the number of students who successfully moved on an integer
data$num_successful <- as.integer(data$NUMERATOR_NUM_SUCCESSFUL)

# Make the student grade a factor
data$grade <- as.factor(data$STUDENT_GRADE)

# Drop the unnecessary columns
data <- subset(data, select=-c(BASE_YEAR, SCHOOL_YEAR, G2G_TRANSITION_RATE,
                               MEASURE_NAME, DENOMINATOR_STUDIED_COHORT,
                               NUMERATOR_NUM_SUCCESSFUL, STUDENT_GRADE,
                               DISTRICT_NAME))
```

```{r data-prep-2, echo=FALSE, message=FALSE, warning=FALSE, results=FALSE}
data %>% 
  filter(DATA_LEVEL == "Province Level") %>%
  filter(FACILITY_TYPE == "All Facility Types") -> data_province
```

```{r data-prep-3, echo=FALSE, message=FALSE, warning=FALSE, results=FALSE}
# Drop all the rows in our table regarding data on a "Province Level"
# This is because we will not use it for the remainder of the assignment
data_district <- data %>% filter(DATA_LEVEL == "District Level")
data_district$district <- as.integer(data_district$DISTRICT_NUMBER)

# Now that we're on a district level, we can use the location data
data_district <- left_join(x=data_district, y=locations, 
                           by=c("district" = "DISTRICT_NUMBER"))

# Drop columns that aren't used
data_district <- subset(data_district, select=-c(
  DISTRICT_PROVINCE, DISTRICT_POSTAL_CODE, 
  DISTRICT_PHONE_NUMBER, DISTRICT_WEBSITE,
  SCHOOL_YEAR))

# Turn our district into a factor variable
data_district$district <- as.factor(data_district$district)

# Check what we have
summary(data_district)
```

```{r data-prep-4, echo=FALSE, message=FALSE, warning=FALSE, results=FALSE}
# Prepare the data for data_school from the main data set
data_school <- data %>% filter(DATA_LEVEL == "School Level")
data_school$district <- as.integer(data_school$DISTRICT_NUMBER)

# Prepare the class_sizes dataset for merging
class_sizes$year <- strtoi(substr(class_sizes$SCHOOL_YEAR, 1, 4))
c_size_merge <- class_sizes %>%
  filter(DATA_LEVEL == "School Level") %>%
  select(-c(DATA_LEVEL, DISTRICT_NUMBER, SCHOOL_NAME,
            PUBLIC_OR_INDEPENDENT))
# Prepare data for Machine Learning. Merge our school data with the class sizes
ML_school_data <- left_join(x=data_school, y=c_size_merge,
                            by=c("SCHOOL_NUMBER" = "SCHOOL_NUMBER",
                                 "year" = "year")) %>%
  filter(year >= min(c_size_merge$year)) %>%
  filter(PUBLIC_OR_INDEPENDENT == "BC Public School") %>%
  select(-c(NUM_OF_SCHOOLS_IN_DATA_LEVEL, SCHOOL_YEAR, DISTRICT_NUMBER,
            FACILITY_TYPE))
# Use the correct average for the correct grade groupp
ML_school_data <- ML_school_data %>%
  mutate(AVG_CLASS_SIZE_GRADE_GROUP =
           case_when(
             ML_school_data$grade==1 ~ AVG_CLASS_SIZE_1_3,
             ML_school_data$grade==2 ~ AVG_CLASS_SIZE_1_3,
             ML_school_data$grade==3 ~ AVG_CLASS_SIZE_1_3,
             ML_school_data$grade==4 ~ AVG_CLASS_SIZE_4_7,
             ML_school_data$grade==5 ~ AVG_CLASS_SIZE_4_7,
             ML_school_data$grade==6 ~ AVG_CLASS_SIZE_4_7,
             ML_school_data$grade==7 ~ AVG_CLASS_SIZE_4_7,
             ML_school_data$grade==8 ~ AVG_CLASS_SIZE_8_12,
             ML_school_data$grade==9 ~ AVG_CLASS_SIZE_8_12,
             ML_school_data$grade==10 ~ AVG_CLASS_SIZE_8_12,
             ML_school_data$grade==11 ~ AVG_CLASS_SIZE_8_12,
           )) %>%
  select(-c(AVG_CLASS_SIZE_K, AVG_CLASS_SIZE_1_3, 
            AVG_CLASS_SIZE_4_7, AVG_CLASS_SIZE_8_12))
# Replace the suitable NAs with 0s
ML_school_data$TOTAL_CLASSES_GREATER_30[is.na(ML_school_data$TOTAL_CLASSES_GREATER_30)] <- 0
ML_school_data$TOTAL_WITH_EA[is.na(ML_school_data$TOTAL_WITH_EA)] <- 0
ML_school_data <- na.omit(ML_school_data)
# Modify the teacher_1 datAset to have a year attribute
teacher_1$year <- strtoi(substr(teacher_1$`SCHOOL YEAR`, 1, 4))
# Prepare an intermediate dataset so merging goes smoothly
teacher_1 %>%
  filter(GENDER=="All") %>%
  filter(`Educators CATEGORY`=="Educators") %>%
  filter(`DATA LEVEL`=="DISTRICT LEVEL") %>%
  select(c(year, `DISTRICT NUMBER`, `FULLTIME Educators CNT`,
           `PARTIME Educators CNT`)) -> teacher_merge
teacher_merge$`FULLTIME Educators CNT`[is.na(teacher_merge$`FULLTIME Educators CNT`)] <- 0
teacher_merge$`PARTIME Educators CNT`[is.na(teacher_merge$`PARTIME Educators CNT`)] <- 0  
teacher_merge$`DISTRICT NUMBER` <- as.integer(teacher_merge$`DISTRICT NUMBER`)
ML_school_data <- left_join(x=ML_school_data, y=teacher_merge,
                            by=c("district" = "DISTRICT NUMBER",
                                 "year" = "year"))
ML_school_data$`FULLTIME Educators CNT` <- strtoi(ML_school_data$`FULLTIME Educators CNT`)
ML_school_data$`PARTIME Educators CNT` <- strtoi(ML_school_data$`PARTIME Educators CNT`)
```

All files that were used are of the '.csv' format. Our main data came in the form of 3 files containing information regarding BC grade-to-grade transitions on a provincial, district and school level (the 3 files for 3 different decades). It is worth noting that few of the files were tidy--many of the files had some rows that recorded data on "all students" whilst other rows recorded data on "Indigenous students", so each row should not be treated as its own observation. As such, we had to be careful when working with it. We merged and filtered the data from all of the files into three data tables--one for the provincial level, one for the district level, and one for the school value. Rather than imputing, we removed entries in our table with missing data, as I felt as though imputation would lead to my figures being misleading.

### Procedure

Before doing anything meaningful, we should first do some exploratory data analysis. Based on the structure of the data, I felt as though it would be most appropriate to look at the situation from all three levels. We begin by making interactive figures to understand the situation from a provincial and district level. We will also perform basic model fitting on a school level. By mimicking the structure of our data, we can make the most out of it! Our data exploration is primarily for the purpose of answering our first question: **How has the British Columbian Government's educational support (as indicated by grade-to-grade transition rates) in the past 30 years differed in different kinds of schools, as well as for different types of British Columbian students (i.e., Indigenous? Special needs?)?**

After doing some basic Exploratory Data Analysis, we will fit some machine learning models (namely bagging, random forests, and boosting) on a school level, as there are not enough features or number of observations on the district and provincial levels to fit these machine-learning models in a meaningful way. The primary focus of this section is to answer our second question: **Are there any other specific attributes that lead to a lower/higher quality of educational support?**

$$\\[0.2in]$$

## Results

Let us begin with some exploratory data analysis. 

### Exploratory Data Analysis {.tabset}

You can see the plots and analysis that were made for the provincial, district and school levels by clicking on the corresponding tabs.

#### Provincial Level

Below is an interactive plot that shows the grade-to-grade transition rates over time. Using the drop menus located on the lower right corner of the grid, we can tweak our population of interest. The axis is fixed for ease of comparison, but you can always zoom in. We can observe various things by tweaking the settings of the plot. Below are just a few discoveries that I found.

* In the `Province-Total` and `All Students` setting, we can see that overall, as time went by, the percentage of students that successfully transitioned to the next grade increased. This is the most prominent for students in grades 8-11. It is also worth noting that the percentage of students in grades 10/11 that successfully transition to the next grade are significant lower than the percentage of students in the lower grades that successfully transition.
* Keeping the bottom dropdown as `All Students` but altering the top dropdown between `BC Public School` and `BC Independent School`, we can see that the rates of grade transitions for students of BC public schools are lower than that of BC independent schools, but the increase in the rate of successful grade transitions is significantly higher in public schools. Furthermore, private schools (i.e., independent schools) seem to have a much higher rate of transition, especially for grade levels 8 and above. This does make sense, as private schools are often times more expensive, and so the students attending them naturally live in my affluent families.
* Keeping the top dropdown as `Province-Total` but altering the bottom dropdown between `Indigenous` and `Non Indigenous`, we can see that the rate of successful grade transitions is significantly lower in Indigenous students compared to their non-Indigenous counterparts. We can also see that the increase in the rates of grade transitions over the years is higher for Indigenous students compared to non-Indigenous students.
* Keeping the top dropdown as `Province-Total` but altering the bottom dropdown between `Non Special Needs` and `Special Needs`, we can see that the rate of successful grade transitions is significantly lower in special needs students compared to students without special needs.

$$\\[0.1in]$$

```{r plot-prep1, echo=FALSE, message=FALSE, warning=FALSE}
province_plot <- data_province %>%  # Code for the plot
  plot_ly(x = ~year, 
          y=~rate, 
          type="scatter", 
          mode="line",
          customdata = ~SUB_POPULATION,
          ids = ~PUBLIC_OR_INDEPENDENT,
          color=~grade, 
          colors="Set2",
          hoverinfo = 'text',
          text = ~paste('</br> Year: ', year,
                        '</br> Grade: ', grade,
                      '</br> Transition Rate: ', rate),
          transforms=list(
            list(
              type = 'filter',
              target = 'customdata',
              operation = '=',
              value = unique(data_province$SUB_POPULATION)[1]
              ),
            list(
              type = 'filter',
              target = 'ids',
              operation = '=',
              value = unique(data_province$PUBLIC_OR_INDEPENDENT)[1]
              )
            )
          ) %>% # The dropdown menu for SUBPOPULATION
  layout(
    title="OVerall Rate of Successful Grade Transitions (1993-2020)",
    yaxis = list(title = "% of Students who Transitioned to the Next Grade",
                 range = c(40,100)),
    xaxis=list(title="Year",
               categoryorder = "array",
              categoryarray = data_province$year),
    legend = list(title=list(text='<b> Student Grade Level </b>')),
    updatemenus = list(
      list(
        x=1,
        y = 0.1,
        type = 'dropdown',
        direction="up",
        active = 0,
        buttons=list(
          list(method = "restyle",
               args = list("transforms[0].value", unique(data_province$SUB_POPULATION)[1]),
               label = unique(data_province$SUB_POPULATION)[1]),
          list(method = "restyle",
               args = list("transforms[0].value", unique(data_province$SUB_POPULATION)[2]),
               label = unique(data_province$SUB_POPULATION)[2]),
          list(method = "restyle",
               args = list("transforms[0].value", unique(data_province$SUB_POPULATION)[3]),
               label = unique(data_province$SUB_POPULATION)[3]),
          list(method = "restyle",
               args = list("transforms[0].value", unique(data_province$SUB_POPULATION)[4]),
               label = unique(data_province$SUB_POPULATION)[4]),
          list(method = "restyle",
               args = list("transforms[0].value", unique(data_province$SUB_POPULATION)[5]),
               label = unique(data_province$SUB_POPULATION)[5])
          )
        ),
      list(
        x=1,
        y = 0.2,
        type = 'dropdown',
        direction="up",
        active = 0,
        buttons=list(
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_province$PUBLIC_OR_INDEPENDENT)[1]),
               label = unique(data_province$PUBLIC_OR_INDEPENDENT)[1]),
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_province$PUBLIC_OR_INDEPENDENT)[2]),
               label = unique(data_province$PUBLIC_OR_INDEPENDENT)[2]),
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_province$PUBLIC_OR_INDEPENDENT)[3]),
               label = unique(data_province$PUBLIC_OR_INDEPENDENT)[3])
          )
        )
  ))

# Had a lot of trouble creating this plot, but this link helped:
# https://stackoverflow.com/questions/52321695/filter-a-plotly-line-chart-based-on-categorical-variable
```

```{r plot1, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Figure 1: An interactive graph depicting the percentage of students in BC of each grade level that successfully transition to the next grade between the years 1993 and 2020."}
province_plot
```

$$\\[0.1in]$$

#### District Level

Below are two interactive plots. Figure 2 is an interactive heatmap that displays all the data we have regarding the transition rates for each group, district, and year. Below is a short explanation of the abbreviations used.

* If there are no bracketed abbreviation in the figure, then you are looking at "All Students"
* `(NSN)` is an abbreviation for "Non Special Needs"
* `(SN)` is an abbreviation for "special Needs"
* `(NI)` is an abbreviation for "Non Indigenous"
* `(I)` is an abbreviation for "Indigenous"

Figure 3 consists of an interactive boxplot that summarizes the data for all the districts for each year. The axis is fixed for ease of comparison, but you can always zoom in (or hover your mouse to see more details). There are many interesting things you can find with the interactive plots. Below are just a few findings from our figures:

* The percentage of students who transitioned to the next grade for Grade 11 fluctuates very dramatically. Playing with the interactive boxplot, one can see that the variation in the rate of transitions from grade 11 to 12 from 2015 to 2020 has been significantly reduced (when compared with the past years). The median of the rates has also increased over time. As such, these plots suggest that there is more equality (due to the decrease in variation) in terms of education/opportunities across the districts, and the education/opportunities offered is of a higher quality (as indicated by the higher median).
* Playing with the settings of Figure 3, we can see that for most grades (particularly the higher grades, like grade 11) the median percentage of Indigenous students per district who transitioned is significantly lower than that of non-Indigenous students in 1993. This difference is much smaller in 2020, but the median percentage is still less. The same can be said about the variation: the interquartile range (IQR) for the Indigenous 11th graders in different districts was much larger than that of the non-Indigenous counterparts in 1993. In 2020, this different has indeed shrunk, but the IQR for the Indigenous children is still roughly twice that of their non-Indigenous counterparts. As such, we can certainly say that there's an improvement in the quality of education/opportunities for both Indigenous children and non-Indigenous children, but more work needs to be done.
* The relationship between students with special needs and those without (again, particularly for the higher grades) is very similar to what was seen between Indigenous and non-Indigenous children--the variation for both of the rates decreased over time, but the variation of the rates for the students with special needs was typically higher than the rate for students with special needs. The difference now is minimal though (at least when compared to the past). Likewise, the median rates for both increased over time (although there was a period of time in which the special needs rates were decreasing), but the non-special needs students had a higher median rate for a while now. That said, the difference in the median rate in 2020 was very small.

$$\\[0.1in]$$
```{r heatmap_func, echo=FALSE}
# A function to make our heatmap matrixes much more easily
gen_heatmap_mat <- function(gr, sub_pop="All Students"){
  data_district %>%
    filter(SUB_POPULATION==sub_pop) %>%
    filter(grade == gr) %>%
    select(DISTRICT_NAME, year, rate) %>%
  mutate(DISTRICT_NAME = as.factor(DISTRICT_NAME)) -> district_mat
  
  district_mat2 <- as.data.frame(pivot_wider(district_mat, 
                                             names_from=DISTRICT_NAME,
                                            values_from = rate))
  
  district_mat2 %>%
  column_to_rownames("year") %>%
  as.matrix()
}
```

```{r plot-2, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Figure 2: Heatmap displaying the trend in overall transition rates for students of each district over the years."}

# Generate our text labels

# The actual 
plot_ly(x=colnames(gen_heatmap_mat(1)), 
        y=rownames(gen_heatmap_mat(1)), 
        type="heatmap",
        zmin=20,
        zmax=100,
        showscale=FALSE) %>%
  add_trace(z=gen_heatmap_mat(1), visible=TRUE, coloraxis = 'coloraxis', name="Grade 1") %>%
  add_trace(z=gen_heatmap_mat(2), visible=FALSE, coloraxis = 'coloraxis', name="Grade 2") %>%
  add_trace(z=gen_heatmap_mat(3), visible=FALSE, coloraxis = 'coloraxis', name="Grade 3") %>%
  add_trace(z=gen_heatmap_mat(4), visible=FALSE, coloraxis = 'coloraxis', name="Grade 4") %>%
  add_trace(z=gen_heatmap_mat(5), visible=FALSE, coloraxis = 'coloraxis', name="Grade 5") %>%
  add_trace(z=gen_heatmap_mat(6), visible=FALSE, coloraxis = 'coloraxis', name="Grade 6") %>%
  add_trace(z=gen_heatmap_mat(7), visible=FALSE, coloraxis = 'coloraxis', name="Grade 7") %>%
  add_trace(z=gen_heatmap_mat(8), visible=FALSE, coloraxis = 'coloraxis', name="Grade 8") %>%
  add_trace(z=gen_heatmap_mat(9), visible=FALSE, coloraxis = 'coloraxis', name="Grade 9") %>%
  add_trace(z=gen_heatmap_mat(10), visible=FALSE, coloraxis = 'coloraxis', name="Grade 10") %>%
  add_trace(z=gen_heatmap_mat(11), visible=FALSE, coloraxis = 'coloraxis', name="Grade 11") %>%
  add_trace(z=gen_heatmap_mat(1, "Non Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 1 (NSN)") %>% 
  add_trace(z=gen_heatmap_mat(2, "Non Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 2 (NSN)") %>%
  add_trace(z=gen_heatmap_mat(3, "Non Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 3 (NSN)") %>%
  add_trace(z=gen_heatmap_mat(4, "Non Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 4 (NSN)") %>%
  add_trace(z=gen_heatmap_mat(5, "Non Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 5 (NSN)") %>%
  add_trace(z=gen_heatmap_mat(6, "Non Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 6 (NSN)") %>%
  add_trace(z=gen_heatmap_mat(7, "Non Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 7 (NSN)") %>%
  add_trace(z=gen_heatmap_mat(8, "Non Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 8 (NSN)") %>%
  add_trace(z=gen_heatmap_mat(9, "Non Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 9 (NSN)") %>%
  add_trace(z=gen_heatmap_mat(10, "Non Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 10 (NSN)") %>%
  add_trace(z=gen_heatmap_mat(11, "Non Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 11 (NSN)") %>%
  add_trace(z=gen_heatmap_mat(1, "Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 1 (SN)") %>% 
  add_trace(z=gen_heatmap_mat(2, "Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 2 (SN)") %>%
  add_trace(z=gen_heatmap_mat(3, "Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 3 (SN)") %>%
  add_trace(z=gen_heatmap_mat(4, "Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 4 (SN)") %>%
  add_trace(z=gen_heatmap_mat(5, "Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 5 (SN)") %>%
  add_trace(z=gen_heatmap_mat(6, "Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 6 (SN)") %>%
  add_trace(z=gen_heatmap_mat(7, "Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 7 (SN)") %>%
  add_trace(z=gen_heatmap_mat(8, "Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 8 (SN)") %>%
  add_trace(z=gen_heatmap_mat(9, "Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 9 (SN)") %>%
  add_trace(z=gen_heatmap_mat(10, "Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 10 (SN)") %>%
  add_trace(z=gen_heatmap_mat(11, "Special Needs"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 11 (SN)") %>%
  add_trace(z=gen_heatmap_mat(1, "Non Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 1 (NI)") %>% 
  add_trace(z=gen_heatmap_mat(2, "Non Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 2 (NI)") %>%
  add_trace(z=gen_heatmap_mat(3, "Non Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 3 (NI)") %>%
  add_trace(z=gen_heatmap_mat(4, "Non Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 4 (NI)") %>%
  add_trace(z=gen_heatmap_mat(5, "Non Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 5 (NI)") %>%
  add_trace(z=gen_heatmap_mat(6, "Non Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 6 (NI)") %>%
  add_trace(z=gen_heatmap_mat(7, "Non Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 7 (NI)") %>%
  add_trace(z=gen_heatmap_mat(8, "Non Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 8 (NI)") %>%
  add_trace(z=gen_heatmap_mat(9, "Non Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 9 (NI)") %>%
  add_trace(z=gen_heatmap_mat(10, "Non Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 10 (NI)") %>%
  add_trace(z=gen_heatmap_mat(11, "Non Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 11 (NI)") %>%
    add_trace(z=gen_heatmap_mat(1, "Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 1 (I)") %>% 
  add_trace(z=gen_heatmap_mat(2, "Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 2 (I)") %>%
  add_trace(z=gen_heatmap_mat(3, "Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 3 (I)") %>%
  add_trace(z=gen_heatmap_mat(4, "Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 4 (I)") %>%
  add_trace(z=gen_heatmap_mat(5, "Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 5 (I)") %>%
  add_trace(z=gen_heatmap_mat(6, "Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 6 (I)") %>%
  add_trace(z=gen_heatmap_mat(7, "Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 7 (I)") %>%
  add_trace(z=gen_heatmap_mat(8, "Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 8 (I)") %>%
  add_trace(z=gen_heatmap_mat(9, "Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 9 (I)") %>%
  add_trace(z=gen_heatmap_mat(10, "Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 10 (I)") %>%
  add_trace(z=gen_heatmap_mat(11, "Indigenous"), visible=FALSE, coloraxis = 'coloraxis', name="Grade 11 (I)") %>%
  layout(
    coloraxis=list(title = "<b>Rate of Transitions</b>",
                 colorscale='Viridis',
                 cmax=100,
                 cmin=20,
                 reversescale =T),
  annotations = list(text = "<b> Transition rate (%): </b>",  x = 1.2, xref="paper",
                     y = 1.1, yref="paper", showarrow=FALSE ),
  title="Rate of Successful Grade Transitions for Different Districts (1993-2020)",
  xaxis = list(title = "<b>District</b>",
               tickmode='linear'),
  yaxis=list(title="<b>Year</b>"),
  updatemenus = list(
    list(
      x= 0,
      y = 1.3,
      type = 'dropdown',
      direction="down",
      active = 0,
      buttons=list(
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 1), TRUE, rep(FALSE, 53)))),
             label = "Grade 1"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 12), TRUE, rep(FALSE, 42)))),
             label = "Grade 1 (NSN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 23), TRUE, rep(FALSE, 31)))),
             label = "Grade 1 (SN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 34), TRUE, rep(FALSE, 21)))),
             label = "Grade 1 (NI)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 35), TRUE, rep(FALSE, 10)))),
             label = "Grade 1 (I)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 2), TRUE, rep(FALSE, 52)))),
             label = "Grade 2"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 13), TRUE, rep(FALSE, 41)))),
             label = "Grade 2 (NSN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 24), TRUE, rep(FALSE, 30)))),
             label = "Grade 2 (SN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 35), TRUE, rep(FALSE, 19)))),
             label = "Grade 2 (NI)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 46), TRUE, rep(FALSE, 8)))),
             label = "Grade 2 (I)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 3), TRUE, rep(FALSE, 51)))),
             label = "Grade 3"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 14), TRUE, rep(FALSE, 40)))),
             label = "Grade 3 (NSN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 25), TRUE, rep(FALSE, 29)))),
             label = "Grade 3 (SN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 36), TRUE, rep(FALSE, 18)))),
             label = "Grade 3 (NI)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 47), TRUE, rep(FALSE, 7)))),
             label = "Grade 3 (I)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 4), TRUE, rep(FALSE, 50)))),
             label = "Grade 4"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 15), TRUE, rep(FALSE, 39)))),
             label = "Grade 4 (NSN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 26), TRUE, rep(FALSE, 28)))),
             label = "Grade 4 (SN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 37), TRUE, rep(FALSE, 17)))),
             label = "Grade 4 (NI)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 48), TRUE, rep(FALSE, 6)))),
             label = "Grade 4 (I)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 5), TRUE, rep(FALSE, 49)))),
             label = "Grade 5"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 16), TRUE, rep(FALSE, 38)))),
             label = "Grade 5 (NSN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 27), TRUE, rep(FALSE, 27)))),
             label = "Grade 5 (SN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 38), TRUE, rep(FALSE, 16)))),
             label = "Grade 5 (NI)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 49), TRUE, rep(FALSE, 5)))),
             label = "Grade 5 (I)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 6), TRUE, rep(FALSE, 48)))),
             label = "Grade 6"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 17), TRUE, rep(FALSE, 37)))),
             label = "Grade 6 (NSN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 28), TRUE, rep(FALSE, 26)))),
             label = "Grade 6 (SN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 39), TRUE, rep(FALSE, 15)))),
             label = "Grade 6 (NI)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 50), TRUE, rep(FALSE, 4)))),
             label = "Grade 6 (I)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 7), TRUE, rep(FALSE, 47)))),
             label = "Grade 7"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 18), TRUE, rep(FALSE, 36)))),
             label = "Grade 7 (NSN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 29), TRUE, rep(FALSE, 25)))),
             label = "Grade 7 (SN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 40), TRUE, rep(FALSE, 14)))),
             label = "Grade 7 (NI)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 51), TRUE, rep(FALSE, 3)))),
             label = "Grade 7 (I)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 8), TRUE, rep(FALSE, 46)))),
             label = "Grade 8"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 19), TRUE, rep(FALSE, 35)))),
             label = "Grade 8 (NSN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 30), TRUE, rep(FALSE, 24)))),
             label = "Grade 8 (SN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 41), TRUE, rep(FALSE, 13)))),
             label = "Grade 8 (NI)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 52), TRUE, rep(FALSE, 2)))),
             label = "Grade 8 (I)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 9), TRUE, rep(FALSE, 45)))),
             label = "Grade 9"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 20), TRUE, rep(FALSE, 34)))),
             label = "Grade 9 (NSN)"),
          list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 31), TRUE, rep(FALSE, 40)))),
             label = "Grade 9 (SN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 42), TRUE, rep(FALSE, 12)))),
             label = "Grade 9 (NI)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 53), TRUE, rep(FALSE, 1)))),
             label = "Grade 9 (I)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 10), TRUE, rep(FALSE, 44)))),
             label = "Grade 10"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 21), TRUE, rep(FALSE, 33)))),
             label = "Grade 10 (NSN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 32), TRUE, rep(FALSE, 22)))),
             label = "Grade 10 (SN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 43), TRUE, rep(FALSE, 11)))),
             label = "Grade 10 (NI)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 54), TRUE, rep(FALSE, 0)))),
             label = "Grade 10 (I)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 11), TRUE, rep(FALSE, 43)))),
             label = "Grade 11"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 22), TRUE, rep(FALSE, 32)))),
             label = "Grade 11 (NSN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 33), TRUE, rep(FALSE, 21)))),
             label = "Grade 11 (SN)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 44), TRUE, rep(FALSE, 10)))),
             label = "Grade 11 (NI)"),
        list(method = "restyle",
             args = list("visible", as.list(c(rep(FALSE, 0), TRUE, rep(FALSE, 54)))),
             label = "Grade 11 (I)")
    ))))
```

$$\\[0.1in]$$

```{r plot-prep3, echo=FALSE, message=FALSE, warning=FALSE}
district_plot_2 <- data_district %>%
  mutate(year=as.factor(year)) %>%
  plot_ly(
    y=~rate,
    color=~year,
    type="box",
    customdata=~SUB_POPULATION,
    ids=~grade,
    transforms=list(
      list(
        type = 'filter',
        target = 'customdata',
        operation = '=',
        value = unique(data_district$SUB_POPULATION)[1]
        ),
      list(
        type = 'filter',
        target = 'ids',
        operation = '=',
        value = unique(data_district$grade)[1]
        )
      )
    ) %>% # The dropdown menu for SUBPOPULATION
  layout(
    title="Rate of Successful Grade Transitions for Different Districts (1993-2020)",
    yaxis = list(title = "% of Students who Transitioned to the Next Grade",
                 range = c(20,100)),
    xaxis=list(title="Year",
               categoryorder = "array",
              categoryarray = data_province$year),
    annotations = list(text = "<b> Grade: </b>",  x = 0.9, xref="paper",
                       y = 0.13, yref="paper", showarrow=FALSE ),
    showlegend = FALSE,
    updatemenus = list(
      list(
        x=1,
        y = 0.1,
        type = 'dropdown',
        direction="up",
        active = 0,
        buttons=list(
          list(method = "restyle",
               args = list("transforms[0].value", unique(data_district$SUB_POPULATION)[1]),
               label = unique(data_district$SUB_POPULATION)[1]),
          list(method = "restyle",
               args = list("transforms[0].value", unique(data_district$SUB_POPULATION)[2]),
               label = unique(data_district$SUB_POPULATION)[2]),
          list(method = "restyle",
               args = list("transforms[0].value", unique(data_district$SUB_POPULATION)[3]),
               label = unique(data_district$SUB_POPULATION)[3]),
          list(method = "restyle",
               args = list("transforms[0].value", unique(data_district$SUB_POPULATION)[4]),
               label = unique(data_district$SUB_POPULATION)[4]),
          list(method = "restyle",
               args = list("transforms[0].value", unique(data_district$SUB_POPULATION)[5]),
               label = unique(data_district$SUB_POPULATION)[5])
          )
        ),
      list(
        x=1,
        y = 0.2,
        type = 'dropdown',
        direction="up",
        active = 0,
        buttons=list(
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_district$grade)[1]),
               label = unique(data_district$grade)[1]),
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_district$grade)[2]),
               label = unique(data_district$grade)[2]),
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_district$grade)[3]),
               label = unique(data_district$grade)[3]),
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_district$grade)[4]),
               label = unique(data_district$grade)[4]),
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_district$grade)[5]),
               label = unique(data_district$grade)[5]),
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_district$grade)[6]),
               label = unique(data_district$grade)[6]),
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_district$grade)[7]),
               label = unique(data_district$grade)[7]),
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_district$grade)[8]),
               label = unique(data_district$grade)[8]),
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_district$grade)[9]),
               label = unique(data_district$grade)[9]),
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_district$grade)[10]),
               label = unique(data_district$grade)[10]),
          list(method = "restyle",
               args = list("transforms[1].value", unique(data_district$grade)[11]),
               label = unique(data_district$grade)[11])
          )
        )
  ))
```

```{r plot3, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Figure 3: An interactive boxplot depicting the percentage of high school BC students from each district that successfully transitioned to the next grade between the years 1993 and 2020."}
district_plot_2
```

$$\\[0.1in]$$

#### School Level

##### Exploratory Data Analysis for Question 1

```{r advanced-reg-1, echo=FALSE, eval=FALSE}
mod_data_1 <- data_school %>%
  filter(SUB_POPULATION=="Non Indigenous"|SUB_POPULATION=="Indigenous")

#gam_mod<- gam(rate ~ s(year, bs="cr", k=10) + SUB_POPULATION + grade + PUBLIC_OR_INDEPENDENT, #data=mod_data_1)
#summary(gam_mod)
#plot(gam_mod)

lm_mod_1 <- lm(rate ~ year + SUB_POPULATION + grade + PUBLIC_OR_INDEPENDENT, data=mod_data_1)
summary(lm_mod_1)
#plot(lm_mod_1)
```

```{r advanced-reg-2, echo=FALSE, eval=FALSE}
mod_data_2 <- data_school %>%
  filter(SUB_POPULATION=="Non Special Needs"|SUB_POPULATION=="Special Needs")

#gam_mod<- gam(rate ~ s(year, bs="cr", k=10) + SUB_POPULATION + grade + PUBLIC_OR_INDEPENDENT, #data=mod_data_2)
#summary(gam_mod)
#plot(gam_mod)

lm_mod_2 <- lm(rate ~ year + SUB_POPULATION + grade + PUBLIC_OR_INDEPENDENT, data=mod_data_2)
summary(lm_mod_2)
#plot(lm_mod_2)
```

```{r advanced-reg-3, echo=FALSE, eval=FALSE}
mod_data_3 <- data_school %>%
  filter(SUB_POPULATION=="All Students")

#gam_mod<- gam(rate ~ s(year, bs="cr", k=10) + grade + PUBLIC_OR_INDEPENDENT, #data=mod_data_2)
#summary(gam_mod)
#plot(gam_mod)

lm_mod_3 <- lm(rate ~ year + grade + PUBLIC_OR_INDEPENDENT, data=mod_data_3)
summary(lm_mod_3)
#plot(lm_mod_3)
```

I ended up fitting three linear models that predicted grade-to-grade transition rates (i.e., the grade-to-grade transition rate of a specific school, grade level, and a certain population). The first model further split the groups into Indigenous students and non-Indigenous students, while the second model split the group into ones with special needs and without. The third model simply dealt with all students (i.e., we did not split into subgroups). The predictors I used was the year, the grade level of interest, and whether the school was public or private. I also used the sub-population of interest as a predictor in my first two models.

Note that the point of creating these models was not to create a model for future prediction--we will do that at the machine learning section (which is below this section) instead. The models created here were purely for interpretability. As such, although my first, second, and third models had $R^2$ values of 0.2164, 0.1542 and 0.1551, respectively--which are very low $R^2$ values--I was not bothered. The estimated increase in transition rates for each year are all positive (i.e., the slopes), which supports our claim that over time our percentage of successful grade to grade transitions has increase, which suggests the education is improving.

All of the predictors had an extremely small p-values (less than 1e-16), which hints at the fact that it is very likely that there is a difference in grade-to-grade transitions between people of different grades, between Indigenous and non Indigenous students, between special needs and non special students, and between students of public and private/independent schools. The coefficients of our models tell us more about these differences. The first model suggests that Indigenous students had a 2.502% lower mean rate of successful transitions, while our second model suggested that students with special needs have a 1.126% lower mean rate of successful transitions compared to their non-Indigenous and non-special needs counterparts, respectively. Looking at the coefficients for the grades for all of our models, we can also see that our model suggests that students in high school (BC high school starts at grade 8) are significantly less likely to transition to their next grade compared to their elementary school counterparts. This is probably due to the riskier behaviors certain high school students have, which may result them getting in all sorts of trouble. Lastly, our model suggests that the transition rate for public schools is smaller than that of private schools, but this different is fairly negligible. This provides a nice answer to our first question at a school level.

##### Exploratory Data Analysis for Question 2

```{r check_special_needs, eval=FALSE, echo=FALSE}
unique(ML_school_data$SUB_POPULATION)
```

As we will be training a machine learning model on a dataset at the school level, it is worth doing some exploratory data analysis at that dataset. Note that as the dataset that we will use for the machine learning model is the result of merging several datasets, and as some datasets cover a different range of years, the machine learning dataset will only cover years from 2006 and 2016.

Below is an interactive plot showing how the number of full time educators in a district and the average class size for a grade group in a school may have an effect on the grade transition rates. You can change the year and the grade of interest through the dropdown menu. One observation we can make is that the lower grade transition rates are often located on the left side (i.e., low number of full time educators) and for relatively high grades, like grade 11.

```{r school_level_plot, echo=FALSE, fig.cap="Figure 4: A interactive plot that depicts how the number of full time educators in a District, and the average Class Size for a Grade Group for a school may be related to the grade transition rates. Note that there are 3 grade groups here: grades 1-3, 4-7, and 8-11."}
ML_school_data %>%
  mutate(yrgr = paste0("YEAR: ", ML_school_data$year, 
                       " GRADE: ", ML_school_data$grade)) %>%
    filter(year<2017) -> ML_school_data

my_buttons <- list()
for(i in 1:length(unique(ML_school_data$yrgr))){
  my_buttons[[i]] <- list(method="restyle",
                          args = list("transforms[0].value", unique(ML_school_data$yrgr)[i]),
                          label = unique(ML_school_data$yrgr)[i]
                          )
}

ML_school_data %>%
  filter(SUB_POPULATION=="All Students") %>%
  plot_ly(x=~`FULLTIME Educators CNT`, 
          y=~AVG_CLASS_SIZE_GRADE_GROUP, 
          type="scatter",
          text = ~paste('</br> Year: ', year,
                        '</br> District Number: ', district,
                        '</br> District Name: ', DISTRICT_NAME,
                        '</br> School: ', SCHOOL_NAME,        
                        '</br> Grade: ', grade,
                        '</br> Number of Full Time Educators: ', `FULLTIME Educators CNT`,
                        '</br> Average Class Size: ', AVG_CLASS_SIZE_GRADE_GROUP,
                        '</br> Transition Rate: ', rate),
          hoverinfo = "text",
          mode="markers", 
          customdata=~yrgr,
          size=20,
          
          marker = list(opacity=0.5,
                        color=~rate,
                        colorbar = list(title = "<b>Transition Rates (%)</b>"),
                        colorscale='Viridis',
                        showscale = TRUE,
                        reversescale =TRUE,
                        cmin=40,
                        cmax=100),
          transforms=list(
            list(
              type = 'filter',
              target = 'customdata',
              operation = '=',
              value = unique(ML_school_data$yrgr)[1]
              )
            )) %>%
  layout(
    title="<b>Grade Transition Rates at a School Level",
    yaxis = list(title = "Average Class Size for corresponding Grade Group"),
    xaxis=list(title="Number of Full Time Educators in District"),
    updatemenus = list(
      list(
        x=1,
        y = 0.1,
        type = 'dropdown', 
        direction="up",
        active = 0,
        buttons=my_buttons)))
```

### Machine Learning

```{r}
# WORK IN PROGRESS
```

Thanks to our many supplementary data sets.

$$\\[0.1in]$$

## Conclusions and Summary

```{r}
#WORK IN PROGRESS
```

In the future, we could also look at data on various [exam results](https://catalogue.data.gov.bc.ca/dataset/bc-schools-examinations-results) and [assessment statistics](https://catalogue.data.gov.bc.ca/dataset/bc-schools-foundation-skills-assessment-fsa-) provided by the British Columbian government and relate them to our findings in this study.
